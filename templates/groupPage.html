<!DOCTYPE html>
<html>
<head>
    <!--Import materialize.css-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/css/materialize.min.css">

    <!--Let browser know website is optimized for mobile-->
    <link rel="shortcut icon" href="/static/1.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Group {{groupname}}</title>
    <style>
        table, th, td {
            border: 1px solid black;
            text-align: center;
        }
        table {
            width: 300px;
        }
        #message-box {
            overflow-y: scroll;
            word-wrap: break-word;
            height: 70vh;
            padding: 2em 3em;
        }
        #chat-room {
            height: 80vh;
        }
        #link-box-all {
            height: 87vh;
            overflow-y: scroll;
            word-wrap: break-word;
        }
        .tag {
            padding: 6px 10px;
            border-radius: 9px;
            max-width: 15em;
        }
        .connect-info {
            margin:0 auto ;
            padding: 4px 10px;
            border-radius: 9px;
            width: 15em;
        }
        .container {
            margin-left:5%;
        }
    </style>
</head>

<body class="blue-grey lighten-5">
<!--Import jQuery before materialize.js-->
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/js/materialize.min.js"></script>
<nav>
    <div class="nav-wrapper teal">
        <ul>
            <li><a class="brand-logo center">Computer-assisted scientific inquiry experience</a></li>
            <li><a id="toGroupLink" href="#">Return Grouping page</a></li>
        </ul>
    </div>
</nav>
    <div id="all-box" class="row">
        <div class="row">  
        </div>
        <div id="link-box-all" class="col s9">
            <h5>Discuss with your group which of the following activities you want to do in the chat room on the right. After selecting, please press "Go to simulation form" and "Simulation picture" together with your team members to enter the same simulation for operation.</h5>
            <h5>The following are instructions for entering the simulation form:</h5>
            <h5>Click "Login". Then click on your group and choose your name. The password is 789. Next, you will be able to discuss the questions with your group members and answer and edit your answers.</h5>
            <br>
            <br>
            <br>
            <div  class="row">
                <div id="link-box1" class="col s6">
                    <h5 style="text-align: center; font-weight: bold;">turing simulation</h5>
                    <br>
                    <h5 style="line-height: 150%;">The theme of this activity is how a vehicle successfully turns. What is the physical principle of turning? Why do we need to slow down when it rains, otherwise we will slip easily? Join your team in a collaborative simulation to explore the science behind these questions!</h5>
                    <br>
                    <div class="row">
                        <table>
                            <thead>
                                <tr>
                                    <th>cooperative simulation</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <a id="frictionLink" href="#" target="_blank"><img src="/static/frictionSimu.png" alt="cooperative simulation" width="200"/></a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <br>
                        <a href="https://legacy.cosci.tw/logInActivity/?gn=oTtXoS809030&actType=0" target="_blank"><button id="btn_toAct_1">Go to form page</button></a>
                        <br>
                    </div>
                </div>
                <div id="link-box2" class="col s6">
                    <h5 style="text-align: center; font-weight: bold;">archery simulation</h5>
                    <br>
                    <h5 style="line-height: 150%;">The theme of this activity is how the force applied by the archer's hand is converted into the speed of the arrow when shooting. If you want to shoot an arrow faster, should you choose a bow with a larger elastic coefficient or a smaller one? Join your team in a collaborative simulation to explore the science behind these questions!</h5>
                    <br>
                    <div class="row">
                        <table>
                            <thead>
                                <tr>
                                    <th>cooperative simulation</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <a id="archerLink" href="#" target="_blank"><img src="/static/archerSimu.png" alt="cooperative simulation" width="200"/></a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <br>
                        <a href="https://legacy.cosci.tw/logInActivity/?gn=Pvw98Z193998&actType=0" target="_blank"><button id="btn_toAct_1">Go to form page</button></a>
                        <br>
                    </div>
                </div>
            </div>
            <div  class="row">
                <div id="link-box3" class="col s6">
                    <h5 style="text-align: center; font-weight: bold;">collision simulation</h5>
                    <br>
                    <h5 style="line-height: 150%;">The theme of this activity is when two objects collide completely inelastically, how will the direction and magnitude of the velocity change after the collision? What physical principles are involved? Join your team in a collaborative simulation to explore the science behind these questions!</h5>
                    <br>
                    <div class="row">
                        <table>
                            <thead>
                                <tr>
                                    <th>cooperative simulation</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <a id="collisionLink" href="#" target="_blank"><img src="/static/collisionSimu.png" alt="cooperative simulation" width="200"/></a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <br>
                        <a href="https://legacy.cosci.tw/logInActivity/?gn=8c2Ns8893259&actType=0" target="_blank"><button id="btn_toAct_1">Go to form page</button></a>
                        <br>
                    </div>
                </div>
                <div id="link-box3" class="col s6">
                    <h5 style="text-align: center; font-weight: bold;">friction simulation</h5>
                    <br>
                    <h5 style="line-height: 150%;">The theme of this activity is when your hand exerts force on an object next to the wall, what factors will affect whether the object will slide down? If you are separated from the wall by two objects, the direction of the friction force between the two objects and What's the size? Join your team in a collaborative simulation to explore the science behind these questions!</h5>
                    <br>
                    <div class="row">
                        <table>
                            <thead>
                                <tr>
                                    <th>cooperative simulation</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <a id="wallfrictionLink" href="#" target="_blank"><img src="/static/wallfrictionSimu.png" alt="cooperative simulation" width="200"/></a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <br>
                        <a href="https://legacy.cosci.tw/logInActivity/?gn=sOfgUi387278&actType=0" target="_blank"><button id="btn_toAct_1">Go to form page</button></a>
                        <br>
                    </div>
                </div>
            </div>
        </div>
        <div id="chat-room" class="col s3">
            <div id="groupChatroomTag" class="white"><p class="center">group {{groupname}} chatroom</p></div>
            <div id="message-box" class="col s12 white z-depth-1"></div>
            <input id="send-msg-inp" type="text" class="validate">
            <button id="send-msg-btn" class="btn waves-effect waves-light right" type="button"
                    name="action">
                send
            </button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.1/socket.io.js"></script>
    <script>
        let room = '{{ room }}'
        let username = '{{ username }}'
        let groupnameStr = '{{ groupname }}' 
        let groupname = parseInt(groupnameStr)
        let frictionRooms = ["J85T1K270013","AWg2hi322900","ZVhG8m347591","GrVaKb414501","NgBFd3428612","l3Cxg8439108","Ofmmxz487717","z1t708521036","ut0l4t532756","OPLLH6545428","r9mb2K558748","0TUMQl570700","bL2nW4587268","dGl0DE604317","Cm2Nt5621324","Cm2Nt5621316","Cm2Nt5621317","Cm2Nt5621318","Cm2Nt5621319","Cm2Nt5621320","Cm2Nt5621321","Cm2Nt5621322","Cm2Nt5621323","Cm2Nt5621324","Cm2Nt5621325","Cm2Nt5621326","Cm2Nt5621327","Cm2Nt5621328","Cm2Nt5621329","Cm2Nt5621330"]
        let archerRooms = ["Ki2xNG748563","KP0Dk6128219","ra6iBr157371","guyWSw166732","iyd7rs180475","MzKiyi190163","7yANpy199332","cdlGxT208650","ocdz7h216875","38Q8nh228371","gd4TKZ237265","b2rWka247225","oUmgOh256577","EolG7x265211","4m98EE274016","4m98EE274017","4m98EE274018","4m98EE274019","4m98EE274020","4m98EE274021","4m98EE274022","4m98EE274023","4m98EE274024","4m98EE274025","4m98EE274026","4m98EE274027","4m98EE274028","4m98EE274029","4m98EE274030","4m98EE274031"]
        let collisionRooms = ["4yTC8Z443976","SD1G1i453961","MZzeTm473841","hQOxVI483145","W1HxBA492903","KX7m9c501544","9IzA01510198","BmNTZd524826","ZULcMc534968","GUMM3F544710","nDiQl5552541","Tpv2SC561477","ERLzDX570286","T7wyLz578453","L0i5pM589173","L0i5pM589116","L0i5pM589117","L0i5pM589118","L0i5pM589119","L0i5pM589120","L0i5pM589121","L0i5pM589122","L0i5pM589123","L0i5pM589124","L0i5pM589125","L0i5pM589126","L0i5pM589127","L0i5pM589128","L0i5pM589129","L0i5pM589130"]
        let wallfrictionRooms = ["QRBRSy098944","K9IvdP111287","aNl9z2120895","rZhPOF129615","8AHL4x138711","r8zhNc154695","gAWNt3169087","am2Tc3179063","OyazXi189006","9VKUdg197999","R1Gas6206278","E3u5aM214182","vniI3l222654","zDsWbG231262","FcqpBc239232","FcqpBc239216","FcqpBc239217","FcqpBc239218","FcqpBc239219","FcqpBc239220","FcqpBc239221","FcqpBc239222","FcqpBc239223","FcqpBc239224","FcqpBc239225","FcqpBc239226","FcqpBc239227","FcqpBc239228","FcqpBc239229","FcqpBc239230"]
        let inp = document.querySelector('#send-msg-inp')
        let sendMsgBtn = document.querySelector('#send-msg-btn')
        let messageBox = document.querySelector('#message-box')
        let frictionLinkTag = document.querySelector('#frictionLink')
        frictionLinkTag.setAttribute('href', ["https://legacy.cosci.tw/gather?name=iyFd0h1697099704032&room=", frictionRooms[groupname - 1],"&amount=1&maxuser=6&sync=false&lang=zh_TW"].join(''))
        let archerLinkTag = document.querySelector('#archerLink')
        archerLinkTag.setAttribute('href', ["https://legacy.cosci.tw/gather?name=PhzlN71632455566649&room=", archerRooms[groupname - 1],"&amount=1&maxuser=6&sync=false&lang=zh_TW"].join(''))
        let collisionLinkTag = document.querySelector('#collisionLink')
        collisionLinkTag.setAttribute('href', ["https://legacy.cosci.tw/gather?name=5g8CFI1515985952004&room=", collisionRooms[groupname - 1],"&amount=1&maxuser=6&sync=false&lang=zh_TW"].join(''))
        let wallfrictionLinkTag = document.querySelector('#wallfrictionLink')
        wallfrictionLinkTag.setAttribute('href', ["https://legacy.cosci.tw/gather?name=JNEEGO1697100022903&room=", wallfrictionRooms[groupname - 1],"&amount=1&maxuser=6&sync=false&lang=zh_TW"].join(''))
        // let urlHeader = location.protocol + '//' + document.domain + ':' + location.port;
        let urlHeader = "http://127.0.0.1:3080";
        // let urlHeader ="https://coinquiry.cosci.tw";
        let toGroupBtnTag = document.querySelector('#toGroupLink')
        toGroupBtnTag.setAttribute('href', [urlHeader, "/group/"].join(''))
        // let leaveroom = document.querySelector('#leaveroom')
        let socket = io();
        // 連接
        // socket.connect(location.protocol + '//' + document.domain + ':' + location.port);
        socket.connect("http://127.0.0.1:3080");
        // 加入
        socket.emit('join', {
            username: username,
            room: room
        })
        // 退出
        /*leaveroom.onclick = function () {
            socket.emit('leave', {
                username: username,
                room: room
            })
        }*/
        // 發送
        sendMsgBtn.onclick = function () {
            let inp = document.querySelector('#send-msg-inp')
            let msg = inp.value
            let user = username
            inp.value = ''
            console.log("send:"+msg);
            if(msg){
                socket.emit('send msg', {
                    user: user,
                    message: msg,
                    room: room,
                })
                messageBox.scrollTop = messageBox.scrollHeight
            }else {
                alert('the messages can not be empty.')
            }
        }
        // enter發送
        inp.addEventListener("keyup", function(event) {
            event.preventDefault();
            if (event.keyCode === 13) {
                sendMsgBtn.click();
            }
        });
        // 連接的訊息
        socket.on('connect info', function (data) {
            let connectInfo = document.createElement('div')
            connectInfo.className = 'row'
            let msg = `
              <div class="col s4 offset-s4">
                <div class="connect-info grey lighten-4 center" >
                  <span class="black-text">${data}
                  </span>
                </div>
              </div>`
            connectInfo.innerHTML = msg
            messageBox.appendChild(connectInfo)
        })
        // 接受訊息
        socket.on('send msg', function (data) {
            if(data.room === room){
                console.log("receive:"+data)
                console.log(data)
                console.log(socket.id)
                let msg = null
                let msgbox = document.createElement('div')
                msgbox.className = 'row'
                if (data.user === username) {
                    msg = `
                  <div class="col right">
                    <div class="tag teal z-depth-3" >
                      <span class="white-text">${data.message}
                      </span>
                    </div>  
                  </div>`
                } else {
                    msg = `
                  <div class="col">
                    <div class="tag z-depth-3">
                      <span class="teal-text"><b>${data.user}</b>:  ${data.message}
                      </span>
                    </div>
                  </div>`
                }
                msgbox.innerHTML = msg
                messageBox.appendChild(msgbox)
                messageBox.scrollTop = messageBox.scrollHeight
            }
        })
    </script>
</body>
</html>